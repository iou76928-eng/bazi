# -*- coding: utf-8 -*-
# æ³¨æ„ï¼šæ­¤æª”æ¡ˆå·²ç§»é™¤ tkinterï¼Œå°ˆä¾› Render é›²ç«¯ç’°å¢ƒä½¿ç”¨
# ==========================================
# 1. è§£è®€è³‡æ–™åº« (å®Œæ•´ä¿ç•™æ‚¨çš„æ–‡æ¡ˆ)
# ==========================================

ZHI = list("å­ä¸‘å¯…å¯è¾°å·³åˆæœªç”³é…‰æˆŒäº¥")

# 1. ç¬¬ä¸€å±¤ï¼šä»Šæ—¥é‹å‹¢è§£è®€ (é‡å° æ—¥æ”¯ vs æ—¥æ”¯)
INTERPRETATIONS_DAY = {
    "æ²–": """
ã€ä»Šæ—¥ç‹€æ…‹ã€‘
å…§åœ¨æ‹‰æ‰¯æ„Ÿå¼·ï¼Œæƒ³å‹•ã€æƒ³æ”¹ã€æƒ³æ›æ–¹å‘ï¼Œä½†åˆ¤æ–·é›œè¨Šé«˜ã€‚

ğŸ‘‰ å»ºè­°ï¼š
é‡è¦æ±ºå®šå»¶å¾Œ
è¡Œå‹•ä»¥ã€Œæ¸…ç†ã€èª¿æ•´ã€ç§»å‹•ã€ç‚ºä¸»
ä¸è¦åœ¨æƒ…ç·’æ³¢å‹•æ™‚åšæ‰¿è«¾

è¡Œå‹•æŒ‡å¼•
æ•´ç†æ¸…å–®ã€åˆªæ¸›è¨ˆç•«
åªåšã€Œå¯é€†ã€çš„äº‹
æŠŠå®šæ¡ˆç•™çµ¦æ˜å¤©

ä¸€å¥æ ¸å¿ƒæé†’
ğŸ‘‰ ä»Šå¤©å¯ä»¥å‹•ï¼Œä½†ä¸è¦å®šéŒ¨
""",
    
    "å…­åˆ": """
ã€ä»Šæ—¥ç‹€æ…‹ã€‘
å…§å¤–ç‹€æ…‹å°é½Šï¼Œæºé€šé †ã€é˜»åŠ›ä½ã€‚

ğŸ‘‰ å»ºè­°ï¼šé©åˆè«‡åˆ¤ã€å”å•†ã€æºé€š

é©åˆä¿®å¾©é—œä¿‚
å°äº‹å¯é †æ‰‹å®Œæˆ

è¡Œå‹•æŒ‡å¼•
ä¸»å‹•è¯çµ¡ä¸€å€‹äºº
è™•ç†å¡å¾ˆä¹…çš„å°è©±
æŠŠè©±èªªæ¸…æ¥šå°±å¥½

ä¸€å¥æ ¸å¿ƒæé†’
ğŸ‘‰ ä»Šå¤©èªªå‡ºå£çš„è©±ï¼Œå®¹æ˜“è¢«ç†è§£ã€‚
""",
    
    "åˆ‘ (è‡ªåˆ‘)": """
ã€ä»Šæ—¥ç‹€æ…‹ã€‘
æƒ…ç·’èˆ‡æ€ç·’åè¦†æ‰“è½‰ï¼Œè‡ªå·±å¡è‡ªå·±ã€‚

ğŸ‘‰ å»ºè­°ï¼š
åœæ­¢åè¦†æ€è€ƒåŒä¸€ä»¶äº‹
è¡Œå‹•è¦ç°¡å–®ã€å–®ä¸€
ä¸è¿½æ±‚å®Œç¾

è¡Œå‹•æŒ‡å¼•
åšä¸€ä»¶ã€Œä¸ç”¨æƒ³å¤ªå¤šã€çš„å°äº‹
è¨­æ™‚é–“ä¸Šé™
æƒ³ä¸é€šå°±å…ˆæ”¾ä¸‹

ä¸€å¥æ ¸å¿ƒæé†’
ğŸ‘‰ ä»Šå¤©ä¸æ˜¯ä½ ä¸è¡Œï¼Œæ˜¯æƒ³å¤ªå¤šã€‚
""",

    "åˆ‘ (ç„¡æ©ä¹‹åˆ‘)": """
ã€ä»Šæ—¥ç‹€æ…‹ã€‘
è²¬ä»»æ„Ÿéé‡ï¼Œå®¹æ˜“è¦ºå¾—ã€Œéƒ½æ˜¯æˆ‘è©²æ‰›ã€ã€‚

ğŸ‘‰ å»ºè­°ï¼š
ä¸ä¸»å‹•å¤šæ¥ä»»å‹™
å€åˆ†ã€Œè©²åšã€èˆ‡ã€Œåˆ¥äººè©²åšã€
é¿å…éåº¦ä»˜å‡º

è¡Œå‹•æŒ‡å¼•
æ˜ç¢ºåˆ†å·¥
è©²æ‹’çµ•å°±æ‹’çµ•
æŠŠç•Œç·šèªªæ¸…æ¥š

ä¸€å¥æ ¸å¿ƒæé†’
ğŸ‘‰ ä»Šå¤©ä½ ä¸ç”¨è­‰æ˜è‡ªå·±ã€‚
""",

    "åˆ‘ (æƒå‹¢ä¹‹åˆ‘)": """
ã€ä»Šæ—¥ç‹€æ…‹ã€‘
å®¹æ˜“ç”¨æ„å¿—ç¡¬æ¨äº‹æƒ…ï¼Œå¿½ç•¥é˜»åŠ›ã€‚
ğŸ‘‰ å»ºè­°ï¼š
æ”¾æ…¢ç¯€å¥
å¤šè½å›é¥‹
ä¸ç”¨æ€¥è‘—å£“éåˆ¥äºº

è¡Œå‹•æŒ‡å¼•
å•ä¸€å¥ã€Œä½ çš„æƒ³æ³•æ˜¯ï¼Ÿã€
èª¿æ•´æ–¹å¼ï¼Œè€Œéç›®æ¨™
ç•™ç©ºé–“çµ¦å°æ–¹

ä¸€å¥æ ¸å¿ƒæé†’
ğŸ‘‰ ä»Šå¤©æŸ”ä¸€é»ï¼Œåè€Œèµ°å¾—æ›´é ã€‚
""",

    "åˆ‘ (ç„¡ç¦®ä¹‹åˆ‘)": """
ã€ä»Šæ—¥ç‹€æ…‹ã€‘
æƒ…ç·’è¡¨é”ç›´æ¥ï¼Œå®¹æ˜“ç„¡æ„å‚·äººã€‚

ğŸ‘‰ å»ºè­°ï¼š
èªªè©±å‰å¤šåœä¸€ç§’
é¿å…æƒ…ç·’åŒ–å›æ‡‰
ä¸åœ¨æ°£é ­ä¸Šå°è©±

è¡Œå‹•æŒ‡å¼•
ç”¨æ–‡å­—ä»£æ›¿å³æ™‚å›æ‡‰
æŠŠæƒ…ç·’å…ˆå¯«ä¸‹ä¾†
ç­‰å¹³ç©©å†èªª

ä¸€å¥æ ¸å¿ƒæé†’
ğŸ‘‰ ä»Šå¤©ä¸æ˜¯ä½ èªªéŒ¯ï¼Œæ˜¯å¤ªå¿«ã€‚""",

    "å®³": """
ã€ä»Šæ—¥ç‹€æ…‹ã€‘
éš±æ€§æ¶ˆè€—æ—¥ï¼Œå®¹æ˜“è¢«äººäº‹ç‰½å‹•ï¼Œåšå®Œäº‹ç‰¹åˆ¥ç´¯ã€‚

ğŸ‘‰ å»ºè­°ï¼š
æ¸›å°‘æƒ…ç·’å‹å‹•
ä¿ç•™ç•Œç·šï¼Œä¸å¤šæ‰›
ä¸å¿…äº‹äº‹å›æ‡‰

è¡Œå‹•æŒ‡å¼•
å°‘ç¤¾äº¤ã€å°‘è§£é‡‹
æŠŠæ™‚é–“ç•™çµ¦è‡ªå·±
æœ‰ç–²ç´¯æ„Ÿæ™‚ç›´æ¥åœ

ä¸€å¥æ ¸å¿ƒæé†’
ğŸ‘‰ ä»Šå¤©ä¿è­·èƒ½é‡ï¼Œæ¯”å®Œæˆäº‹æƒ…é‡è¦ã€‚
""",
    
    "ç ´": """
ã€ä»Šæ—¥ç‹€æ…‹ã€‘
çµæ§‹é¬†å‹•ï¼Œç´°ç¯€å®¹æ˜“å‡ºéŒ¯ï¼Œå°åœ°æ–¹æ…¢æ…¢è€—èƒ½ã€‚

ğŸ‘‰ å»ºè­°ï¼š
æª¢æŸ¥æ¯”æ¨é€²é‡è¦
æ”¾æ…¢ç¯€å¥ï¼Œè£œæ¼æ´
è²¡å‹™ã€åˆç´„éœ€åè¦†ç¢ºèª

è¡Œå‹•æŒ‡å¼•
å›é ­æª¢æŸ¥å·²å®Œæˆçš„äº‹
è£œè³‡æ–™ã€è£œæµç¨‹ã€è£œèªªæ˜
ä¸è¿½æ•ˆç‡ï¼Œåªæ±‚ç©©å®š

ä¸€å¥æ ¸å¿ƒæé†’
ğŸ‘‰ ä»Šå¤©ä¸æ˜¯æ…¢ï¼Œæ˜¯åœ¨é¿å…å¾Œæ‚”ã€‚
""",
    
    "åŠåˆ": """
ã€ä»Šæ—¥ç‹€æ…‹ã€‘
åŠ©åŠ›å‡ºç¾ï¼Œä½†å°šæœªæˆå±€ï¼Œéœ€è¦ä½ å…ˆå‹•ã€‚

ğŸ‘‰ å»ºè­°ï¼šé©åˆé‹ªè·¯ï¼Œä¸é©åˆæ”¶æˆ

è¡Œå‹•æ¯”è§€æœ›é‡è¦
ä¸ç”¨ä¸€æ¬¡åšåˆ°ä½

è¡Œå‹•æŒ‡å¼•
å…ˆåšç¬¬ä¸€æ­¥
è©¦æ°´æº«ã€ä¸Ÿå‡ºè¨Šè™Ÿ
ç´¯ç©æ¢ä»¶ï¼Œä¸æ€¥è‘—çµæœ

ä¸€å¥æ ¸å¿ƒæé†’
ğŸ‘‰ ä»Šå¤©æ˜¯åœ¨ç´¯ç©ï¼Œä¸æ˜¯çµç®—ã€‚
""",
    
    "ç„¡ç‰¹æ®Šé—œä¿‚": """
ã€ä»Šæ—¥ç‹€æ…‹ã€‘
å¹³å¹³æ·¡æ·¡ï¼Œé©åˆæŒ‰éƒ¨å°±ç­ã€‚

ğŸ‘‰ å»ºè­°ï¼šå°ˆæ³¨åœ¨æ‰‹é‚Šçš„å·¥ä½œã€‚"""
}

# 2. ç¬¬äºŒå±¤ï¼šæœ¬æœˆç’°å¢ƒè§£è®€ (é‡å° æ—¥æ”¯ vs æœˆæ”¯)
INTERPRETATIONS_MONTH = {
    "æ²–": """
ã€æœ¬æœˆæ°£å ´ã€‘
é€™æ®µæ™‚é–“ä½ å®¹æ˜“åœ¨æ–¹å‘èˆ‡é¸æ“‡ä¹‹é–“åè¦†ï¼Œ
ä¸€é‚Šæƒ³æ¨é€²ï¼Œä¸€é‚Šåˆæƒ³é‡ä¾†ã€‚
ä¸æ˜¯ä½ å„ªæŸ”å¯¡æ–·ï¼Œè€Œæ˜¯å¤–åœ¨ç’°å¢ƒèˆ‡å…§åœ¨ç¯€å¥ä¸åŒæ­¥ã€‚

ğŸ‘‰ æœˆæé†’ï¼š
è¨ˆç•«å®¹æ˜“ä¿®æ”¹
å°ã€Œè¦ä¸è¦æ›æ–¹å‘ã€ç‰¹åˆ¥æ•æ„Ÿ
å¿ƒè£¡å¸¸åŒæ™‚å­˜åœ¨å…©å€‹ç­”æ¡ˆ
æœ¬æœˆèª¿æ•´æ–¹å‘å»ºè­°
ä¸æ€¥è‘—ä¸€æ¬¡é¸å°
å…è¨±è©¦éŒ¯èˆ‡å¾®èª¿
æŠŠã€Œé¸æ“‡ã€æ‹†æˆéšæ®µå®Œæˆ

ä¸€å¥èƒŒæ™¯å‹æ ¸å¿ƒæé†’
ğŸ‘‰ æœ€è¿‘çš„é‡é»ä¸æ˜¯å®šæ¡ˆï¼Œè€Œæ˜¯é‡æ¸…ã€‚
""",
    
    "å…­åˆ": """
ã€æœ¬æœˆæ°£å ´ã€‘
è¿‘æœŸç‹€æ…‹èƒŒæ™¯å®šç¾©
é€™æ®µæ™‚é–“ä½ çš„å…§å¤–ç‹€æ…‹è¼ƒå®¹æ˜“å°é½Šï¼Œ
äººéš›äº’å‹•èˆ‡æºé€šé˜»åŠ›åä½ã€‚

ğŸ‘‰ æœˆæé†’ï¼š
å®¹æ˜“è¢«ç†è§£
é—œä¿‚ä¿®å¾©æ©Ÿæœƒå¢åŠ 
åˆä½œæ„é¡˜æé«˜
æœ¬æœˆèª¿æ•´æ–¹å‘å»ºè­°
ç¶“ç‡Ÿé•·æœŸé—œä¿‚
æŠŠè©±èªªæ¸…æ¥šã€èªªå®Œæ•´
æ¨å‹•éœ€è¦å…±è­˜çš„äº‹

ä¸€å¥èƒŒæ™¯å‹æ ¸å¿ƒæé†’
ğŸ‘‰ æœ€è¿‘é©åˆæŠŠé—œä¿‚èµ°å¾—æ›´ç©©ã€‚
""",
    
    "åˆ‘": """
ã€æœ¬æœˆæ°£å ´ã€‘
è¿‘æœŸç‹€æ…‹èƒŒæ™¯å®šç¾©
é€™æ®µæ™‚é–“å…§åœ¨å¼µåŠ›è¼ƒé«˜ï¼Œ
å®¹æ˜“æ„Ÿåˆ°å£“åŠ›ã€è²¬ä»»æˆ–è‡ªæˆ‘è¦æ±‚åŠ é‡ã€‚

ğŸ‘‰ æœˆæé†’ï¼š
æƒ³å¾—å¤šã€åšå¾—æ…¢
å°è‡ªå·±è¦æ±‚åé«˜
å®¹æ˜“ç´¯ç©æ‚¶æ„Ÿ
æœ¬æœˆèª¿æ•´æ–¹å‘å»ºè­°
æ”¾ä¸‹éåº¦è‡ªè²¬
èª¿æ•´æœŸå¾…å€¼
æŠŠåŠ›æ°£ç”¨åœ¨å¯æ§ç¯„åœ

ä¸€å¥èƒŒæ™¯å‹æ ¸å¿ƒæé†’
ğŸ‘‰ æœ€è¿‘ä¸æ˜¯ä½ ä¸å¤ å¥½ï¼Œè€Œæ˜¯è² è·å¤ªå¤šã€‚""",

    "å®³": """
ã€æœ¬æœˆæ°£å ´ã€‘
è¿‘æœŸç‹€æ…‹èƒŒæ™¯å®šç¾©
é€™æ®µæ™‚é–“ä½ å®¹æ˜“åœ¨ä¸è‡ªè¦ºä¸­ä»˜å‡ºèƒ½é‡ï¼Œ
å°äººã€å°äº‹éƒ½æ¯”è¼ƒå®¹æ˜“è¢«ç‰½å‹•ã€‚

ğŸ‘‰ æœˆæé†’ï¼š
åšå®Œäº‹ç‰¹åˆ¥ç´¯
æƒ…ç·’å®¹æ˜“è¢«å½±éŸ¿
å¾ˆé›£å®Œå…¨æ”¾é¬†
æœ¬æœˆèª¿æ•´æ–¹å‘å»ºè­°
é‡è¨­ç•Œç·šèˆ‡ç¯€å¥
æ¸›å°‘ä¸å¿…è¦çš„æƒ…ç·’æŠ•å…¥
æŠŠã€Œç…§é¡§è‡ªå·±ã€æ”¾å›å„ªå…ˆé †åº

ä¸€å¥èƒŒæ™¯å‹æ ¸å¿ƒæé†’
ğŸ‘‰ æœ€è¿‘çš„ç–²ç´¯ï¼Œä¾†è‡ªç•Œç·šæ¨¡ç³Šï¼Œä¸æ˜¯èƒ½åŠ›ä¸è¶³ã€‚
""",

    "ç ´": """
ã€æœ¬æœˆæ°£å ´ã€‘
è¿‘æœŸç‹€æ…‹èƒŒæ™¯å®šç¾©
é€™æ®µæ™‚é–“äº‹æƒ…å®¹æ˜“è®Šå¾—é›¶æ•£ã€ç‘£ç¢ï¼Œ
ä¸æ˜¯å¤§å•é¡Œï¼Œè€Œæ˜¯åŸæœ¬çš„çµæ§‹é–‹å§‹ä¸åˆç”¨ã€‚

ğŸ‘‰ æœˆæé†’ï¼š
å°äº‹è®Šå¤š
å¸¸è¦ºå¾—ã€Œä¸€ç›´åœ¨è£œã€
é›£ä»¥ä¸€æ¬¡åšåˆ°ä½
æœ¬æœˆèª¿æ•´æ–¹å‘å»ºè­°
å›é ­é‡æ•´æµç¨‹èˆ‡æ¶æ§‹
ä¸è¦åªè£œæ´ï¼Œè¦æƒ³é‡æ’
æ¥å—ã€ŒèˆŠæ–¹å¼æ­£åœ¨é€€å ´ã€

ä¸€å¥èƒŒæ™¯å‹æ ¸å¿ƒæé†’
ğŸ‘‰ æœ€è¿‘ä¸æ˜¯ä½ æ•ˆç‡å·®ï¼Œè€Œæ˜¯çµæ§‹è©²æ›´æ–°äº†ã€‚
""",

    "åŠåˆ": """ã€æœ¬æœˆæ°£å ´ã€‘
è¿‘æœŸç‹€æ…‹èƒŒæ™¯å®šç¾©
é€™æ®µæ™‚é–“åŠ©åŠ›æ­£åœ¨å½¢æˆï¼Œä½†å°šæœªå®Œå…¨åˆ°ä½ï¼Œ
ä½ æœƒæ„Ÿè¦ºã€Œå¥½åƒå¿«äº†ï¼Œä½†é‚„å·®ä¸€é»ã€ã€‚

ğŸ‘‰ æœˆæé†’ï¼š
æœ‰æ–¹å‘æ„Ÿï¼Œä½†æˆæœæœªæ˜
å®¹æ˜“å¡åœ¨ä¸­æ®µ
éœ€è¦è€å¿ƒé‹ªè·¯
æœ¬æœˆèª¿æ•´æ–¹å‘å»ºè­°
æŒçºŒç´¯ç©æ¢ä»¶
ä¸æ€¥è‘—æ”¶æˆ
å°ˆæ³¨åœ¨ã€Œè®“äº‹æƒ…æ›´æˆç†Ÿã€

ä¸€å¥èƒŒæ™¯å‹æ ¸å¿ƒæé†’
ğŸ‘‰ æœ€è¿‘æ˜¯åœ¨é†é‡€ï¼Œä¸æ˜¯åœæ»¯ã€‚
""",

    "ç„¡ç‰¹æ®Šé—œä¿‚": """ã€æœ¬æœˆæ°£å ´ã€‘é€™å€‹æœˆæ°£å ´ç©©å®šï¼Œç„¡é¢¨ç„¡é›¨ã€‚
ğŸ‘‰ æœˆæé†’ï¼šç´¯ç©å¯¦åŠ›ï¼Œç­‰å¾…æ™‚æ©Ÿã€‚"""
}

# èˆŠç‰ˆå–®ä¸€å­—å…¸ (ç‚ºäº†ç›¸å®¹æ€§ä¿ç•™ä¸€ä»½æŒ‡é‡)
INTERPRETATIONS = INTERPRETATIONS_DAY

# é—œä¿‚å°ç…§è¡¨
LIU_HE = {
    "å­": "ä¸‘", "ä¸‘": "å­", "å¯…": "äº¥", "äº¥": "å¯…",
    "å¯": "æˆŒ", "æˆŒ": "å¯", "è¾°": "é…‰", "é…‰": "è¾°",
    "å·³": "ç”³", "ç”³": "å·³", "åˆ": "æœª", "æœª": "åˆ"
}
LIU_CHONG = {
    "å­": "åˆ", "åˆ": "å­", "ä¸‘": "æœª", "æœª": "ä¸‘",
    "å¯…": "ç”³", "ç”³": "å¯…", "å¯": "é…‰", "é…‰": "å¯",
    "è¾°": "æˆŒ", "æˆŒ": "è¾°", "å·³": "äº¥", "äº¥": "å·³"
}
LIU_HAI = {
    "å­": "æœª", "æœª": "å­", "ä¸‘": "åˆ", "åˆ": "ä¸‘",
    "å¯…": "å·³", "å·³": "å¯…", "å¯": "è¾°", "è¾°": "å¯",
    "ç”³": "äº¥", "äº¥": "ç”³", "é…‰": "æˆŒ", "æˆŒ": "é…‰"
}
XIANG_PO = {
    "å­": "é…‰", "é…‰": "å­", "ä¸‘": "è¾°", "è¾°": "ä¸‘",
    "å¯…": "äº¥", "äº¥": "å¯…", "å¯": "åˆ", "åˆ": "å¯",
    "å·³": "ç”³", "ç”³": "å·³", "æœª": "æˆŒ", "æˆŒ": "æœª"
}
BAN_HE_GROUPS = [
    {"ç”³", "å­", "è¾°"}, {"å·³", "é…‰", "ä¸‘"},
    {"å¯…", "åˆ", "æˆŒ"}, {"äº¥", "å¯", "æœª"}
]

def check_ban_he(z1, z2):
    for group in BAN_HE_GROUPS:
        if z1 in group and z2 in group and z1 != z2: return True
    return False

def check_xing_detail(z1, z2):
    if z1 == z2 and z1 in ["è¾°", "åˆ", "é…‰", "äº¥"]: return "è‡ªåˆ‘"
    if (z1 == "å­" and z2 == "å¯") or (z1 == "å¯" and z2 == "å­"): return "ç„¡ç¦®ä¹‹åˆ‘"
    if (z1 == "å¯…" and z2 == "å·³") or (z1 == "å·³" and z2 == "ç”³") or (z1 == "ç”³" and z2 == "å¯…"): return "ç„¡æ©ä¹‹åˆ‘"
    if (z1 == "ä¸‘" and z2 == "æˆŒ") or (z1 == "æˆŒ" and z2 == "æœª") or (z1 == "æœª" and z2 == "ä¸‘"): return "æƒå‹¢ä¹‹åˆ‘"
    return None

def analyze_pair_logic(main_zhi, target_zhi, detailed_xing=False):
    """
    ç´”é‚è¼¯å‡½æ•¸ï¼Œå›å‚³é—œä¿‚åˆ—è¡¨
    """
    relations = []
    # é †åºï¼šå…­åˆ -> åŠåˆ -> æ²– -> åˆ‘ -> å®³ -> ç ´ -> ç„¡ç‰¹æ®Š
    if LIU_HE.get(main_zhi) == target_zhi: 
        relations.append({"name": "å…­åˆ", "type": "good"})
    
    if check_ban_he(main_zhi, target_zhi): 
        relations.append({"name": "åŠåˆ", "type": "good"})
        
    if LIU_CHONG.get(main_zhi) == target_zhi: 
        relations.append({"name": "æ²–", "type": "bad"})
        
    xing_type = check_xing_detail(main_zhi, target_zhi)
    if xing_type:
        name = f"åˆ‘ ({xing_type})" if detailed_xing else "åˆ‘"
        relations.append({"name": name, "type": "bad"})
        
    if LIU_HAI.get(main_zhi) == target_zhi: 
        relations.append({"name": "å®³", "type": "warn"})
        
    if XIANG_PO.get(main_zhi) == target_zhi: 
        relations.append({"name": "ç ´", "type": "warn"})
        
    if not relations: 
        relations.append({"name": "ç„¡ç‰¹æ®Šé—œä¿‚", "type": "normal"})
        
    return relations

# ==========================================
# 2. Web å°ˆç”¨ä»‹é¢é¡åˆ¥ (app.py éœ€è¦é€™å€‹)
# ==========================================

class WebBaziAnalyzer:
    @staticmethod
    def get_analysis_result(user_day, today_day, today_month):
        """
        è¼¸å…¥ä¸‰å€‹åœ°æ”¯ï¼Œå›å‚³å®Œæ•´çš„çµæ§‹åŒ–è³‡æ–™ä¾› Web ä½¿ç”¨
        """
        # 1. è¨ˆç®—é—œä¿‚
        layer1_rels = analyze_pair_logic(user_day, today_day, detailed_xing=True)
        layer2_rels = analyze_pair_logic(user_day, today_month, detailed_xing=False)
        
        # 2. å®šç¾©æ ¼å¼åŒ–å‡½æ•¸ (å‚³å…¥ db åƒæ•¸æŒ‡å®šè¦æŸ¥å“ªæœ¬å­—å…¸)
        def format_layer(rels, db):
            result = []
            for rel in rels:
                # å„ªå…ˆæ‰¾å®Œæ•´åç¨± (ä¾‹å¦‚ "åˆ‘ (è‡ªåˆ‘)")
                full_name = rel["name"]
                # å…¶æ¬¡æ‰¾åŸºç¤åç¨± (ä¾‹å¦‚ "åˆ‘")
                base_name = full_name.split(" ")[0]
                
                # å¾æŒ‡å®šçš„ db (è³‡æ–™åº«) æ‰¾æ–‡å­—
                text = db.get(full_name, db.get(base_name, "(å°šç„¡æ­¤é—œä¿‚çš„è©³ç´°è§£è®€è³‡æ–™)"))
                
                result.append({
                    "relation_name": rel["name"],
                    "relation_type": rel["type"],
                    "content": text
                })
            return result

        return {
            "branches": {
                "user_day": user_day,
                "today_day": today_day,
                "today_month": today_month
            },
            # ç¬¬ä¸€å±¤ï¼šæŸ¥ INTERPRETATIONS_DAY
            "layer1": format_layer(layer1_rels, INTERPRETATIONS_DAY),
            
            # ç¬¬äºŒå±¤ï¼šæŸ¥ INTERPRETATIONS_MONTH
            "layer2": format_layer(layer2_rels, INTERPRETATIONS_MONTH)
        }
